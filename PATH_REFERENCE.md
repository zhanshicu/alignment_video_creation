# Path Reference Guide

Quick reference for all data paths in the framework.

---

## ğŸ“ Directory Paths

### Scene Images
```
Path: data/video_scene_cuts/
Structure:
  data/video_scene_cuts/
  â””â”€â”€ {video_id}/
      â””â”€â”€ {video_id}-Scene-001-01.jpg
      â””â”€â”€ {video_id}-Scene-002-01.jpg
      â””â”€â”€ {video_id}-Scene-003-01.jpg
      â””â”€â”€ ...

Example:
  data/video_scene_cuts/123456/123456-Scene-001-01.jpg
  data/video_scene_cuts/123456/123456-Scene-002-01.jpg
  data/video_scene_cuts/abc789/abc789-Scene-001-01.jpg
```

### Keyword Masks
```
Path: data/keyword_masks/
Structure:
  data/keyword_masks/
  â””â”€â”€ {video_id}/
      â””â”€â”€ scene_1.png
      â””â”€â”€ scene_2.png
      â””â”€â”€ scene_3.png
      â””â”€â”€ ...

Example:
  data/keyword_masks/123456/scene_1.png
  data/keyword_masks/123456/scene_2.png
  data/keyword_masks/abc789/scene_1.png
```

### Attention Heatmaps
```
Path: data/attention_heatmap/
Structure:
  data/attention_heatmap/
  â””â”€â”€ {video_id}/
      â””â”€â”€ {video_id}-Scene-001.jpg
      â””â”€â”€ {video_id}-Scene-002.jpg
      â””â”€â”€ {video_id}-Scene-003.jpg
      â””â”€â”€ ...

Example:
  data/attention_heatmap/123456/123456-Scene-001.jpg
  data/attention_heatmap/123456/123456-Scene-002.jpg
  data/attention_heatmap/abc789/abc789-Scene-001.jpg
```

---

## ğŸ“„ File Paths

### Keywords File
```
Path: data/keywords.csv

Format:
  _id,keyword_list[0]
  123456,sneakers
  abc789,smartphone
  xyz999,laptop

Columns:
  - _id: Video identifier (string)
  - keyword_list[0]: Product/keyword (string)
```

### Valid Scenes File (Generated)
```
Path: data/valid_scenes.csv

Generated by: data_validation.ipynb

Columns:
  - video_id: Video identifier
  - scene_number: Scene number (int)
  - keyword: Product keyword
  - scene_image_path: Full path to scene image
  - keyword_mask_path: Full path to keyword mask
  - attention_heatmap_path: Full path to attention heatmap
  - filename: Original filename

Example row:
  123456,1,sneakers,data/video_scene_cuts/123456/123456-Scene-001-01.jpg,keyword_masks/123456/123456-Scene-001-01.png,attention_heatmap/123456/123456-Scene-001-01.jpg,123456-Scene-001-01.jpg
```

---

## ğŸ¬ Output Paths

### Training Outputs
```
Path: outputs/training_v3/

Structure:
  outputs/training_v3/
  â”œâ”€â”€ config.yaml
  â”œâ”€â”€ best_model.pt
  â”œâ”€â”€ latest_model.pt
  â”œâ”€â”€ training_log.txt
  â””â”€â”€ checkpoints/
      â””â”€â”€ epoch_01.pt
      â””â”€â”€ epoch_02.pt
      â””â”€â”€ ...
```

### Variant Outputs
```
Path: outputs/variants_v3/

Structure:
  outputs/variants_v3/
  â”œâ”€â”€ manifest.json
  â””â”€â”€ {video_id}/
      â”œâ”€â”€ baseline_scenes.csv
      â”œâ”€â”€ early_boost_scenes.csv
      â”œâ”€â”€ middle_boost_scenes.csv
      â”œâ”€â”€ late_boost_scenes.csv
      â”œâ”€â”€ full_boost_scenes.csv
      â”œâ”€â”€ reduction_scenes.csv
      â”œâ”€â”€ placebo_scenes.csv
      â”œâ”€â”€ statistics.json
      â”œâ”€â”€ baseline/
      â”‚   â””â”€â”€ attention_heatmap/
      â”‚       â””â”€â”€ {video_id}-Scene-001-01.jpg
      â”‚       â””â”€â”€ ...
      â”œâ”€â”€ early_boost/
      â”‚   â””â”€â”€ attention_heatmap/
      â”‚       â””â”€â”€ {video_id}-Scene-001-01.jpg
      â”‚       â””â”€â”€ ...
      â””â”€â”€ ... (other variants)

Example:
  outputs/variants_v3/123456/early_boost/attention_heatmap/123456-Scene-001-01.jpg
```

---

## ğŸ” Filename Patterns

### Scene Image Filenames
```
Pattern: {video_id}-Scene-{scene_number:03d}-01.jpg
Extension: .jpg or .png

Examples:
  âœ… 123456-Scene-001-01.jpg
  âœ… abc789-Scene-042-01.jpg
  âœ… xyz999-Scene-123-01.jpg
  âŒ 123456_Scene_1.jpg       (wrong separator)
  âŒ scene001.jpg             (missing video_id)
  âŒ 123456-Scene-1-01.jpg    (number not zero-padded)
```

### Keyword Mask Filenames
```
Pattern: scene_{scene_number}.png
Extension: .png (must be PNG for masks)

Examples:
  âœ… scene_1.png
  âœ… scene_42.png
  âœ… scene_123.png
  âŒ scene-1.png           (wrong separator)
  âŒ scene_1.jpg           (wrong extension)
  âŒ scene_001.png         (don't use zero-padding)
```

### Attention Heatmap Filenames
```
Pattern: {video_id}-Scene-{scene_number:03d}.jpg
Extension: .jpg or .png
NOTE: No "-01" suffix!

Examples:
  âœ… 123456-Scene-001.jpg
  âœ… abc789-Scene-042.jpg
  âœ… xyz999-Scene-123.png
  âŒ 123456-Scene-001-01.jpg  (don't use -01 suffix)
```

---

## ğŸ› ï¸ Path Construction in Code

### Loading Scene Data
```python
# Given video_id and scene_number
video_id = "123456"
scene_number = 1

# Construct paths
scene_image_path = f"data/video_scene_cuts/{video_id}/{video_id}-Scene-{scene_number:03d}-01.jpg"
keyword_mask_path = f"data/keyword_masks/{video_id}/scene_{scene_number}.png"
attention_heatmap_path = f"data/attention_heatmap/{video_id}/{video_id}-Scene-{scene_number:03d}.jpg"

# Results:
# scene_image_path = "data/video_scene_cuts/123456/123456-Scene-001-01.jpg"
# keyword_mask_path = "data/keyword_masks/123456/scene_1.png"
# attention_heatmap_path = "data/attention_heatmap/123456/123456-Scene-001.jpg"
```

### Parsing Scene Filename
```python
import re

filename = "123456-Scene-042-01.jpg"
pattern = r'^(.+?)-Scene-(\d+)-01\.(jpg|png)$'
match = re.match(pattern, filename)

if match:
    video_id = match.group(1)      # "123456"
    scene_number = int(match.group(2))  # 42
    extension = match.group(3)     # "jpg"
```

---

## âœ… Path Verification Checklist

Before running the framework, verify these paths exist:

### For Training
- [ ] `data/video_scene_cuts/` exists and contains video folders
- [ ] `keyword_masks/` exists and contains video folders
- [ ] `attention_heatmap/` exists and contains video folders
- [ ] `data/keywords.csv` exists
- [ ] `data/valid_scenes.csv` exists (run `data_validation.ipynb` if not)

### For Inference
- [ ] `outputs/training_v3/best_model.pt` exists (trained model)
- [ ] `outputs/variants_v3/` exists
- [ ] Variant scene CSVs exist in `outputs/variants_v3/{video_id}/`

### Quick Check Script
```python
import os

# Check required directories
required_dirs = [
    'data/video_scene_cuts',
    'keyword_masks',
    'attention_heatmap',
]

for dir_path in required_dirs:
    if os.path.exists(dir_path):
        num_videos = len([d for d in os.listdir(dir_path) if os.path.isdir(os.path.join(dir_path, d))])
        print(f"âœ… {dir_path}: {num_videos} video folders")
    else:
        print(f"âŒ {dir_path}: NOT FOUND")

# Check required files
required_files = [
    'data/keywords.csv',
]

for file_path in required_files:
    if os.path.exists(file_path):
        print(f"âœ… {file_path}: exists")
    else:
        print(f"âŒ {file_path}: NOT FOUND")

# Check valid_scenes.csv
if os.path.exists('data/valid_scenes.csv'):
    import pandas as pd
    df = pd.read_csv('data/valid_scenes.csv')
    print(f"âœ… data/valid_scenes.csv: {len(df)} valid scenes from {df['video_id'].nunique()} videos")
else:
    print(f"âš ï¸  data/valid_scenes.csv: NOT FOUND (run data_validation.ipynb to generate)")
```

---

## ğŸ”„ Path Changes from V2

| Component      | V2 Path                     | V3 Path                                    | V3 Filename Format |
|----------------|-----------------------------|--------------------------------------------|-------------------|
| Scene images   | `data/screenshots_tiktok/`  | `data/video_scene_cuts/`                   | `{video_id}-Scene-{num:03d}-01.jpg` |
| Keyword masks  | `data/keyword_masks/`       | `data/keyword_masks/`                      | `scene_{num}.png` |
| Attention      | (scalar in CSV)             | `data/attention_heatmap/` (new directory)  | `{video_id}-Scene-{num:03d}.jpg` (no -01) |
| Valid scenes   | (none)                      | `data/valid_scenes.csv` (new file)         | N/A |
| Variants       | `outputs/variants/`         | `outputs/variants_v3/`                     | N/A |
| Training       | `outputs/training/`         | `outputs/training_v3/`                     | N/A |

---

**Quick Reference Version**: 3.0
**Last Updated**: 2024-11-19
